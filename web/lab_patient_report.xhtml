<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">

    <head>
    </head>

    <body>

        <ui:composition template="./resources/template/template1.xhtml">


            <ui:define name="content">


                <h:panelGroup rendered="#{!(webUserController.hasPrivilege('LabAutherizing') eq true or webUserController.hasPrivilege('LabDataentry') eq true or webUserController.hasPrivilege('LabPrinting') eq true)}" >
                    You are NOT authorized
                </h:panelGroup>

                <h:panelGroup rendered="#{webUserController.hasPrivilege('LabAutherizing') eq true or webUserController.hasPrivilege('LabDataentry') eq true or webUserController.hasPrivilege('LabPrinting') eq true   }" styleClass="nonPrintBlock">

                    <h:form id="form">
                        <p:growl id="messages" showDetail="true"/> 
                        <p:panel header="Approve Report" styleClass="alignTop" >
                            <h:panelGrid columns="2" >
                                <p:panel header="Patient Details" >
                                    <p:panelGrid columns="2" >

                                        <h:outputLabel value="Name" ></h:outputLabel>
                                        <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.nameWithTitle}" ></h:outputLabel>
                                        <h:outputLabel value="Age" ></h:outputLabel>
                                        <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.age}" ></h:outputLabel>
                                        <h:outputLabel value="Sex" ></h:outputLabel>
                                        <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.sex}" ></h:outputLabel>
                                        <h:outputLabel value="Investigation" ></h:outputLabel>
                                        <h:outputLabel value="#{patientReportController.currentPatientReport.item.name}" ></h:outputLabel>

                                    </p:panelGrid>
                                </p:panel>

                                <p:panel  >


                                    <f:facet name="header" >
                                        <p:panelGrid columns="5" >
                                            <h:outputLabel value="Investigation Results" ></h:outputLabel>
                                            <h:panelGroup rendered="#{patientReportController.currentPatientReport.approved ne true}" >
                                                <p:commandButton rendered="#{webUserController.hasPrivilege('LabDataentry') eq true }"  value="Save" action="#{patientReportController.savePatientReport()}" ajax="false" >
                                                </p:commandButton>
                                            </h:panelGroup>

                                            <p:commandButton id="btnApprove"  disabled ="#{!(webUserController.hasPrivilege('LabAutherizing') eq true and patientReportController.currentPatientReport.dataEntered eq true )}"   value="Approve" action="#{patientReportController.approvePatientReport()}" ajax="false" >
                                            </p:commandButton>
                                            <p:commandButton  value="Report Search" action="lab_search_for_reporting" ajax="false" >
                                            </p:commandButton>
                                            <h:commandButton  value="Calculate" action="#{patientReportController.calculate}"  >
                                            </h:commandButton>

                                            <p:tooltip for="btnApprove" value="Fade effect is used by default" showEffect="fade" hideEffect="fade"> 
                                                <h:outputLabel rendered="#{(patientReportController.currentPatientReport.dataEntered ne true )}"  value="You have to enter data and save before approving"/>
                                                <h:outputLabel rendered="#{!(webUserController.hasPrivilege('LabAutherizing') eq true )}"  value="You have no privilege to approve"/>
                                                <h:outputLabel rendered="#{(webUserController.hasPrivilege('LabAutherizing') eq true and patientReportController.currentPatientReport.dataEntered eq true )}"  value="Click to approve results"/>
                                            </p:tooltip>

                                        </p:panelGrid>
                                    </f:facet>

                                    <p:tabView id="tabView"> 

                                        <p:tab title="Values">

                                            <table>

                                                <ui:repeat value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="pv" >
                                                    <tr>
                                                        <td>
                                                            <h:panelGroup rendered="#{pv.investigationItem.ixItemType eq 'Value' and pv.investigationItem.retired eq false}"  style="min-width: 300px" >
                                                                <h:outputLabel value="#{pv.investigationItem.name}" style="min-width:400px;"></h:outputLabel>
                                                            </h:panelGroup>
                                                        </td>
                                                        <td>
                                                            <p:selectOneMenu editable="true" value="#{pv.strValue}" rendered="#{pv.investigationItem.ixItemType eq 'Value' and pv.investigationItem.ixItemValueType eq 'Varchar' and pv.investigationItem.retired eq false}" style="min-width:400px; text-align: left;" >
                                                                <f:selectItems value="#{pv.investigationItem.investigationItemValues}" var="iiv" itemLabel="#{iiv.name}" itemValue="#{iiv}" />
                                                            </p:selectOneMenu>
                                                            <p:inputText value="#{pv.doubleValue}" rendered="#{pv.investigationItem.ixItemType eq 'Value' and pv.investigationItem.ixItemValueType eq 'Double' and pv.investigationItem.retired eq false}" style="min-width:400px; text-align: left;"  ></p:inputText>
                                                            <p:editor value="#{pv.lobValue}" rendered="#{pv.investigationItem.ixItemType eq 'Value' and pv.investigationItem.ixItemValueType eq 'Memo' and pv.investigationItem.retired eq false}" style="width:400px; text-align: left;"  ></p:editor>

                                                        </td>
                                                    </tr>
                                                </ui:repeat>


                                            </table>


                                        </p:tab  >                           

                                        <p:tab title="Calculations">                               

                                            <table>

                                                <ui:repeat value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="pv" >
                                                    <tr>
                                                        <td>
                                                            <h:panelGroup rendered="#{pv.investigationItem.ixItemType eq 'Calculation' and pv.investigationItem.retired eq false}"  style="min-width: 300px" >
                                                                <h:outputLabel value="#{pv.investigationItem.name}" style="min-width:400px;"></h:outputLabel>
                                                            </h:panelGroup>
                                                        </td>
                                                        <td>
                                                            <p:inputText value="#{pv.doubleValue}" rendered="#{pv.investigationItem.ixItemType eq 'Calculation' and pv.investigationItem.retired eq false}" style="min-width:400px; text-align: left;"  >
                                                                <f:convertNumber pattern="0.0" />
                                                            </p:inputText>
                                                        </td>
                                                    </tr>
                                                </ui:repeat>


                                            </table>


                                        </p:tab  >                           


                                        <p:tab title="Dynamic Labels">
                                            <table>
                                                <ui:repeat value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="pv" >
                                                    <tr>
                                                        <td>
                                                            <h:panelGroup rendered="#{pv.investigationItem.ixItemType eq 'DynamicLabel' and pv.investigationItem.retired eq false}"  style="min-width: 300px" >
                                                                <h:outputLabel value="#{pv.investigationItem.name}" style="min-width:400px;"></h:outputLabel>
                                                            </h:panelGroup>
                                                        </td>
                                                        <td>
                                                            <p:selectOneMenu editable="true" value="#{pv.strValue}" rendered="#{pv.investigationItem.ixItemType eq 'DynamicLabel'  and pv.investigationItem.retired eq false}" style="min-width:400px; text-align: left;" >
                                                                <f:selectItems value="#{pv.investigationItem.investigationItemValues}" var="iiv" itemLabel="#{iiv.name}" itemValue="#{iiv}" />
                                                            </p:selectOneMenu>
                                                        </td>
                                                    </tr>
                                                </ui:repeat>
                                            </table>
                                        </p:tab>                           


                                    </p:tabView>           

                                </p:panel>

                            </h:panelGrid>
                        </p:panel>

                    </h:form>
                </h:panelGroup>


                <h:form>

                    <p:commandButton styleClass="nonPrintBlock"  ajax="false" value="Print" onclick="window.print();" actionListener="#{patientReportController.printPatientReport()}" />

                </h:form>

                <h:form >

                    <p:panel styleClass="myDivToPrint" id="divPrint" style="border: 0px; margin: 0px; padding: 0px;" >
                        <div id="divReport"  style="min-width:800px;min-height: 1100px; position: relative; font-size: 150%;">


                            <ui:repeat value="#{commonReportItemController.items}" var="myCli" >
                                <div style="#{myCli.cssStyle}; position:absolute;">
                                    <h:outputText rendered="#{myCli.ixItemType eq 'Label' and myCli.retired ne true }"  value="#{myCli.name}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'PatientName' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.nameWithTitle}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'PatientAge' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.patient.age}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'PatientSex' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.sex}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'InvestigationName' and  myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.investigation.name}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'Speciman' and  myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.investigation.sample.name}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'SampledTime' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.sampledAt}" style="color: #{myCli.cssColor}" escape="false" >
                                        <f:convertDateTime pattern="hh mm a"/>
                                    </h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'BilledDate' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.createdAt}" style="color: #{myCli.cssColor}" escape="false" >
                                        <f:convertDateTime pattern="dd MMMM yyyy"></f:convertDateTime>
                                    </h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'BilledTime' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.createdAt}" style="color: #{myCli.cssColor}" escape="false" >
                                        <f:convertDateTime pattern="hh mm a"/>
                                    </h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'SampledDate' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.sampledAt}" style="color: #{myCli.cssColor}" escape="false" >
                                        <f:convertDateTime pattern="dd MMMM yyyy"></f:convertDateTime>
                                    </h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'BillNo' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.insId}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>

                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'ReportedDate' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.dataEntryAt}" style="color: #{myCli.cssColor}" escape="false" >
                                        <f:convertDateTime pattern="dd MMMM yyyy"></f:convertDateTime>
                                    </h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'ReportedTime' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.dataEntryAt}" style="color: #{myCli.cssColor}" escape="false" >
                                        <f:convertDateTime pattern="hh mm a"/>
                                    </h:outputText>
                                    <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'ReferringDoctor' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.referredBy.person.nameWithTitle}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>

                                    <h:inputHidden rendered="#{myCli.reportItemType eq 'AutherizedSignature' and myCli.retired eq false }"    value="#{staffController.current}"  >
                                    </h:inputHidden>

                                    <p:graphicImage rendered="#{myCli.reportItemType eq 'AutherizedSignature' and myCli.retired eq false }"    value="#{staffController.signature}" style="width: #{myCli.cssWidth};"  >
                                    </p:graphicImage>


                                    <h:inputHidden    value="HHHH #{patientReportController.currentPatientReport.patientInvestigation.approveUser}"  >
                                    </h:inputHidden>

                                </div>
                            </ui:repeat>



                            <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                    <h:outputLabel value="#{prv.lobValue}" rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Memo' and prv.investigationItem.retired eq false}"  escape="false" />
                                </div>
                            </ui:repeat>

                            <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                    <h:outputLabel value="#{prv.strValue}" rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Varchar'}" escape="false" />
                                </div>
                            </ui:repeat>

                            <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                    <h:outputLabel value="#{prv.doubleValue}"  rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Double' and prv.investigationItem.retired eq false}"   escape="false" />
                                </div>
                            </ui:repeat>


                            <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                    <h:outputLabel value="#{prv.strValue}" rendered="#{prv.investigationItem.ixItemType eq 'DynamicLabel'}" escape="false" />
                                </div>
                            </ui:repeat>

                            <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                    <h:outputLabel value="#{prv.doubleValue}" rendered="#{prv.investigationItem.ixItemType eq 'Calculation' }" escape="false" >
                                        <f:convertNumber pattern="0.0" />
                                    </h:outputLabel>
                                </div>
                            </ui:repeat>

                            <ui:repeat value="#{patientReportController.currentPatientReport.item.reportItems}" var="myIi" >
                                <div style="#{myIi.cssStyle}; position:absolute;">
                                    <h:outputText rendered="#{myIi.retired ne true and myIi.ixItemType eq 'Label' }" value="#{myIi.name}" style="color: #{myIi.cssColor}" escape="false" ></h:outputText>
                                </div>
                            </ui:repeat>


                        </div>
                    </p:panel>


                </h:form>


            </ui:define>



        </ui:composition>

    </body>
</html>
